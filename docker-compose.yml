version: "3.7"
services:
  tendermint:
    image: "tendermint/tendermint"
    ports:
      - 36656:26656
      - 36657:26657
    command: >
      node
      --moniker=`hostname`
      --proxy_app=kvstore
      --log_level="*:error"
    environment:
      TM_PARAMS: consensus.timeout_commit=1000ms,rpc.max_body_bytes=10000000,rpc.cors_allowed_origins=*,mempool.max_msg_bytes=10000000
    volumes:
      - "/tmp/tendermint:/tendermint"
  hypermint:
    image: bluele/hypermint:unstable
    environment:
      TM_PARAMS: consensus.timeout_commit=1000ms,rpc.max_body_bytes=10000000,rpc.cors_allowed_origins=*,mempool.max_msg_bytes=10000000
    command: >
      /hmd start --home=/root/.hmd
      --log_level="*:error"
      --p2p.laddr="tcp://0.0.0.0:26656"
      --rpc.laddr="tcp://0.0.0.0:26657"
    ports:
      - 26656:26656
      - 26657:26657
    volumes:
      - "/tmp/hypermint:/root/.hmd"
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:26657/status || exit 1"]
      start_period: "30s"
      retries: 10
      timeout: "3s"
      interval: "10s"
  tm-pkcs11:
    build:
      context: .
    command: --addr tendermint:26656 --chain-id test-chain-uAssCJ
    depends_on:
      - hypermint
      - tendermint
    links:
      - hypermint
      - tendermint
